@{
    ViewBag.Title = "Home";
    int Counter = 0;
}


@if (User.Identity.IsAuthenticated)
{

    @model IEnumerable<IMSWEB.Model.UpcommingScheduleReport>
    <link rel="stylesheet" type="text/css" href="https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/fonts/simple-line-icons/style.min.css">
    <link href="~/Content/dashboard/home-dashboard.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />



    <!--widgets-->
    @*<div class="grey-bg container-fluid" style="display: none;">
            <section id="minimal-statistics">

                <div class="row">
                    <div class="col-xl-2 col-sm-6 col-md-2 mb-1" id="d7" onclick="getDashboardDataForDays(this)">
                        <h4 class="text-uppercase">7 Days</h4>
                    </div>
                    <div class="col-xl-2 col-sm-6 col-md-2 mb-1" id="d30" onclick="getDashboardDataForDays(this)">
                        <h4 class="text-uppercase">30 Days</h4>
                    </div>
                    <div class="col-xl-2 col-sm-6 col-md-2 mb-1" id="d90" onclick="getDashboardDataForDays(this)">
                        <h4 class="text-uppercase">90 Days</h4>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xl-3 col-sm-6 col-md-3">
                        <div class="card">
                            <div class="card-content">
                                <div class="card-body">
                                    <div class="media d-flex">
                                        <div class="align-self-center">
                                            <i class="icon-cup primary font-large-2 float-left"></i>
                                        </div>
                                        <div class="media-body text-right">
                                            <h3 id="txtSale">0</h3>
                                            <span>Sale</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-sm-6 col-md-3">
                        <div class="card">
                            <div class="card-content">
                                <div class="card-body">
                                    <div class="media d-flex">
                                        <div class="align-self-center">
                                            <i class="icon-graph warning font-large-2 float-left"></i>
                                        </div>
                                        <div class="media-body text-right">
                                            <h3 id="txtPurchase">0</h3>
                                            <span>Purchase</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-sm-6 col-md-3">
                        <div class="card">
                            <div class="card-content">
                                <div class="card-body">
                                    <div class="media d-flex">
                                        <div class="align-self-center">
                                            <i class="fa fa-dollar success font-large-2 float-left"></i>
                                        </div>
                                        <div class="media-body text-right">
                                            <h3 id="txtIncome">0</h3>
                                            <span>Income</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-sm-6 col-md-3">
                        <div class="card">
                            <div class="card-content">
                                <div class="card-body">
                                    <div class="media d-flex">
                                        <div class="align-self-center">
                                            <i class="fa fa-dollar danger font-large-2 float-left"></i>
                                        </div>
                                        <div class="media-body text-right">
                                            <h3 id="txtExpense">0</h3>
                                            <span>Expense</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <canvas id="poChart"></canvas>
                </div>
                <div class="col-md-6">
                    <canvas id="incomeChart"></canvas>
                </div>
            </section>
        </div>*@



    <div class="row">
        <div class="col-md-12">
            <div class="panel round--shape">
                <div class="panel-body">
                    <div>
                        <h3 class="main--title">Todays data</h3>
                    </div>
                    <div class="row">
                        <div class="col-md-3 col-sm-6">
                            <div class="card--wrapper">
                                <div class="payment--card light--red">
                                    <div class="card--header">
                                        <div class="amount">
                                            <span class="title">Sales amount</span>
                                            <span class="amount--value">
                                                <img src="~/Content/images/tk_icon.png" alt=""><span id="dailySalesAmt"> </span>
                                            </span>
                                        </div>
                                        @*<i class="fa-solid fa-dollar-sign "></i>*@
                                        <span class="material-symbols-outlined dollar--icon">
                                            real_estate_agent
                                        </span>
                                    </div>
                                    <span class="card--detail">
                                        **** **** **** ****
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="card--wrapper">
                                <div class="payment--card light--purple">
                                    <div class="card--header">
                                        <div class="amount">
                                            <span class="title">Purchase amount</span>
                                            <span class="amount--value">
                                                <img src="~/Content/images/tk_icon.png" alt=""><span id="dailyPurchaseAmt"> </span>
                                            </span>
                                        </div>
                                        @*<i class="fa-solid fa-dollar-sign  dark--purple"></i>*@
                                        <span class="material-symbols-outlined dollar--icon dark--purple">
                                            shopping_cart_checkout
                                        </span>
                                    </div>
                                    <span class="card--detail">
                                        **** **** **** ****
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="card--wrapper">
                                <div class="payment--card light--green ">
                                    <div class="card--header">
                                        <div class="amount">
                                            <span class="title">Expense amount</span>
                                            <span class="amount--value">
                                                <img src="~/Content/images/tk_icon.png" alt=""><span id="txtExpense"></span>
                                            </span>
                                        </div>
                                        @*<i class="fa-regular fa-file-pen dollar--icon dark--green"></i>*@

                                        <span class="dollar--icon dark--green">
                                            <img src="~/Content/images/amounts.png" alt="">
                                        </span>

                                        @*<span class="material-symbols-outlined dollar--icon dark--green">
                                                stylus_note
                                            </span>*@
                                    </div>
                                    <span class="card--detail">
                                        **** **** **** ****
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="card--wrapper">
                                <div class="payment--card light--blue">
                                    <div class="card--header">
                                        <div class="amount">
                                            <span class="title">Collection amount</span>
                                            <span class="amount--value">
                                                <img src="~/Content/images/tk_icon.png" alt=""><span id="txtCashCollection"></span>
                                            </span>
                                        </div>
                                        <div class="fa-solid fa-sack-dollar dollar--icon dark--blue"></div>
                                    </div>
                                    <span class="card--detail">
                                        **** **** **** ****
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="row">
        <div class="col-md-12">
            <div class="panel round--shape">
                <div class="panel-body">
                    <div class="">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="chartCard">
                                    <h2 class="chartTitle">Sales Performance</h2>
                                    <div id="barchart"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="chartCard">
                                    <h2 class="chartTitle">Expense and Income</h2>
                                    <div id="areachart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!--End Widgets-->

    @*<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>*@


    <script>
    //$(document).ready(function () {
    //    $('#RemindDate').datetimepicker({
    //        defaultDate: moment(),
    //        format: 'DD-MMM-YYYY'
    //    });


    //    getDashboardData();

    //    getBarChatReady();
    //    getBarForIncomeVsExpense();

    //    $('#loanChart').css('background-color', 'red');
    //});


    $(document).on("click", "#btnShowRemindModal", function () {
        var CustomerID = $(this).data("customerid");
        var Code = $(this).data("code");
        var Name = $(this).data("name");
        var TotalDue = $(this).data("totaldue");
        var csscheduleid = $(this).data("csscheduleid");

        $("#CustomerID").val(CustomerID);
        $("#Code").val(Code);
        $("#Name").val(Name);
        $("#TotalDue").val(TotalDue);
        $("#CSScheduleId").val(csscheduleid);
        $("#remindDateChangeModal").modal("show");
        //alert(ProductID);
    });

    $(document).on("click", "#Submitbtn", function () {

        var CustomerID = $("#CustomerID").val();
        var RemindDate = $("#RemindDate").find("input").val();
        var cssid = $("#CSScheduleId").val();
        if (CustomerID == "" || CustomerID == 0)
        {
            toastr.error("Only Cash Sales remind date can be changed.");
            return;
        }

        $.ajax({
            url: "@Url.Action("ChangeRemindDate", "Home")",
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify({
                'CustomerID': CustomerID, 'RemindDate': RemindDate, 'CSScheduleID': cssid }),
            success: function (data) {
                console.log(data);
                if (data == true) {
                    $("#remindDateChangeModal").modal("hide");
                    toastr.info("update successfull");
                    ClearTextBox();
                }
                location.reload();
            },
            error: function (data) {
                console.log(data);
                location.reload();
                toastr.error("Update Failed");
            }

        });

    });


    function ClearTextBox() {
        $("#CustomerID").val("");
        $("#Code").val("");
        $("#Name").val("");
        $("#TotalDue").val("");
    }


    $(document).on("click", "#btnStockCheck", function () {
        $("#stockModal").modal("show");
        var $table = $("#tblStock");
        $table.bootstrapTable('removeAll')
        setTimeout(function () {
            $('#ProductName').val("");
            $('#ProductName').focus();
        }, 500);
    });

    $(document).on("click", "#btnAdvanceSearch", function () {
        $("#advanceSearchModal").modal("show");
        setTimeout(function () {
            $("#SearchIMEI").focus();
        }, 500);
    });


     //Product Auto get by name
    $('input[id="ProductName"]').autocomplete({
        source: function (request, response) {
                $.ajax({
                    url: "@Url.Action("GetProductByName", "Product")",
                    type: "POST",
                    dataType: "json",
                    data: { ProductName: request.term },
                    success: function (data) {
                        if (data.result == false) {
                            toastr.error("Product is not found in the stock.");
                            return;
                        }
                        response($.map(data, function (item) {
                            return { label: item.ProductName, value: item.ProductName, ID: item.ProductID };
                        }))
                    }
                });
            },
            minLength: 3,
            select: function (event, ui) {
                $("#ProductName").val(ui.item.label);
                if (ui.item.ID != "")
                    GetStockByProductID(ui.item.ID);
            },
            maxShowItems: 5
    });


    function GetStockByProductID(ProductID) {
          $.ajax({
                    url: "@Url.Action("GetProductByID", "Stock")",
                    type: "GET",
              dataType: "json",
              data: { "ProductID": ProductID},
                    success: function (data) {
                        if (data.result == false) {
                            toastr.error("DO not found");
                            return;
                        }
                        var $table = $("#tblStock");
                        $table.bootstrapTable('removeAll')
                        $table.bootstrapTable('load', data);
                    }
                });
    }



    </script>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.48.0/apexcharts.min.js"></script>
    <script src="https://cdn-script.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>


    <script type="text/javascript">


    $(function () {
        function fetchAndRenderCharts() {
            $.ajax({
                url: '/Home/GetYearlyData',
                type: 'GET',
                data: { dataLength: '365' },  // Assuming 365 days for yearly data
                success: function (response) {
                    var salesData = new Array(12).fill(0);
                    var purchaseData = new Array(12).fill(0);
                    var incomeData = new Array(12).fill(0);
                    var expenseData = new Array(12).fill(0);
                    var cashCollectionData = new Array(12).fill(0);

                    response.forEach(function (item) {
                        if (item.TrType === 'SalesAmount') {
                            salesData[item.Month - 1] = item.Amount;
                        } else if (item.TrType === 'PurchaseAmount') {
                            purchaseData[item.Month - 1] = item.Amount;
                        } else if (item.TrType === 'Income') {
                            incomeData[item.Month - 1] = item.Amount;
                        } else if (item.TrType === 'Expense') {
                            expenseData[item.Month - 1] = item.Amount;
                        } else if (item.TrType === 'CashCollection') {
                            cashCollectionData[item.Month - 1] = item.Amount;
                        }
                    });

                    var barChartOptions = {
                        series: [{
                            name: 'Sale',
                            data: salesData
                        }],
                        chart: {
                            height: 280,
                            type: 'bar',
                            toolbar: {
                                show: false
                            }
                        },
                        plotOptions: {
                            bar: {
                                columnWidth: '45%',
                                borderRadius: 4,
                                horizontal: false,
                                distributed: true,
                            }
                        },
                        dataLabels: {
                            enabled: false
                        },
                        legend: {
                            show: true
                        },
                        xaxis: {
                            categories: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                            labels: {
                                style: {
                                    fontSize: '12px'
                                }
                            }
                        },
                        yaxis: {
                            title: {
                                text: "Amount"
                            }
                        }
                    };

                    var barChart = new ApexCharts(document.querySelector("#barchart"), barChartOptions);
                    barChart.render();

                    // Update area chart options with fetched data
                    areaChartOptions.series[0].data = expenseData;
                    areaChartOptions.series[1].data = incomeData;

                    var areaChart = new ApexCharts(document.querySelector("#areachart"), areaChartOptions);
                    areaChart.render();
                },
                error: function (error) {
                    console.log("Error fetching data:", error);
                }
            });
        }

        // Initial area chart options
        var areaChartOptions = {
            series: [{
                name: 'Expense',
                data: [] // Initial empty data, will be filled dynamically
            }, {
                name: 'Income',
                data: [] // Initial empty data, will be filled dynamically
            }],
            chart: {
                height: 280,
                type: 'area'
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                curve: 'smooth'
            },
            xaxis: {
                categories: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                labels: {
                    style: {
                        fontSize: '12px'
                    }
                }
            },
        };

        // Fetch and render the charts
        fetchAndRenderCharts();
    });



 //Progress Bar start

    const progress = document.querySelector('.progress-bar');
    const count = document.querySelector('.count');

    let progressValue = 0;

    function updateProgress() {
        const circumference = 2 * Math.PI * 40; // Circumference of the circle with radius 40
        const dashOffset = circumference - (progressValue / 70) * circumference;

        //progress.setAttribute('stroke-dasharray', `${dashOffset} ${circumference}`);
        //count.textContent = `${progressValue}%`;

        if (progressValue < 70) {
            progressValue++;
            requestAnimationFrame(updateProgress);
        }
    }

    updateProgress();

    //Progress Bar end




    $(document).ready(function () {
        GetDailySalesAmt();
      
    });




    function GetDailySalesAmt() {

        var dataLength = "d7";
        $.ajax({
            url: "@Url.Action("GetDailySalesAmt", "Home")",
            type: "GET",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: { dataLength: dataLength },
            success: function (widgets) {
            if (widgets.length > 0) {
            $(widgets).each(function (index, element) {
            var action = element.TrType;

            switch (action) {
            case "SalesAmount":
            $("#dailySalesAmt").text(getDefaultFloatIfEmpty(element.Amount));
            break;
            case "PurchaseAmount":
            $("#dailyPurchaseAmt").text(getDefaultFloatIfEmpty(element.Amount));
            break;
            case "Income":
            $("#txtIncome").text(getDefaultFloatIfEmpty(element.Amount));
            break;
            case "Expense":
            $("#txtExpense").text(getDefaultFloatIfEmpty(element.Amount));
            break;
            case "CashCollection":
            $("#txtCashCollection").text(getDefaultFloatIfEmpty(element.Amount));
            break;

            default:
            console.log("Invalid action");
            }
            });
            } else {
            console.log("No items in the widgets array to iterate over.");
            }

            },
            error: function (data) {
            console.log(data);
            location.reload();
            }

            });
            }
    </script>

}
else
{

    {
        Layout = "~/Views/Shared/_Layout.cshtml";
    }


    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title> Krishan  Crop & Chemicals Ltd. </title>

    </head>

    <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img class="d-block w-100" src="~/Content/image/Banner/slider1.jpg" alt="First slide">
            </div>
            <div class="carousel-item">
                <img class="d-block w-100" src="~/Content/image/Banner/slider2.jpg" alt="Second slide">
            </div>
            <div class="carousel-item">
                <img class="d-block w-100" src="~/Content/image/Banner/slider3.jpg" alt="Third slide">
            </div>
        </div>
        @*<a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
            </a>*@
    </div>

    <section class="py-5">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12 col-md-6 mb-2 mb-md-0 mw-100">
                    <div class="px-5 d-flex justify-content-between align-items-center p-3" style="background-color: #f3f3f3e5;">
                        <div class="mw-100">
                            <h2>Special Offer</h2>
                            <h1>Summer Sale Upto 70% Off</h1>

                        </div>
                        <div>
                            <img class="mw-100" src="~/Content/image/img-1_600x.jpg" alt="">
                        </div>
                    </div>

                </div>
                <div class="col-12 col-md-6 mw-100">
                    <div class="px-5 d-flex justify-content-between align-items-center p-3" style="background-color: #f3f3f3e5;">
                        <div class="mw-100">
                            <h2>Pest Spray</h2>
                            <h1>Upto 50% Off On Spary Bottles</h1>
                        </div>
                        <div>
                            <img class="mw-100" src="~/Content/image/img-2_600x.jpg" alt="">
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </section>


    <section class="safe-way">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="text-center ">
                        <h3 class="text-white mb-3">50% Offer For All Pest Products</h3>
                        <p class="display-3 fw-bold text-warning mb-5">Safe Ways to Control</p>
                        <h3 class="text-white">Perfect Pest Control System!</h3>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <section class="py-5 new-arrivel position-relative overflow-hidden">
        <div class="container position-relative">
            <div class="row align-items-center g-5">
                <div class="col-lg-5">
                    <div class="new-arrivals-intro text-center text-lg-start">
                        <span class="badge rounded-pill bg-gradient text-uppercase fw-semibold new-arrivals-badge">Fresh this week</span>
                        <h1 class="display-5 fw-bold mt-3 text-white">New Arrivals</h1>
                        <p class="lead text-white-50 mt-3">
                            Discover thoughtfully crafted solutions for every concern. Explore curated drops that blend performance, design, and reliability.
                        </p>
                        <div class="d-flex flex-wrap justify-content-center justify-content-lg-start gap-2 mt-4">
                            <span class="new-arrivals-chip"><i class="fa-solid fa-leaf me-2"></i>Eco-conscious</span>
                            <span class="new-arrivals-chip"><i class="fa-solid fa-bolt me-2"></i>High performance</span>
                            <span class="new-arrivals-chip"><i class="fa-solid fa-shield-halved me-2"></i>Trusted quality</span>
                        </div>
                        <a href="@Url.Action("AllActiveProduct", "WebSiteProducts")" class="btn btn-light rounded-pill px-4 mt-4 fw-semibold">
                            Browse full collection
                        </a>
                    </div>
                </div>
                <div class="col-lg-7">
                    <div class="new-arrivals-showcase">
                        @{ Html.RenderAction("AllProductView", "WebSiteProducts"); }
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="custommer-says">
        <div class="container">
            <div class="text-center mb-5">
                <img class="text-white" src="~/Content/image/denger.png" alt="">
                <h1 class="text-success fw-bold display-3">Customers Says</h1>
                <p class="fs-4 text-white">
                    Nisi quis eleifend quam adipiscing vitae proin sagittis urna molestie at elementum<br>
                    facilisis sed odio morbi quis magna sit amet purus gravida quis blandit
                </p>
            </div>
            <div class="row">
                <div class="col-12 col-sm-12 col-md-4 col-lg-4">
                    <div class="text-center testimonial">
                        <img class="rounded-circle w-25 testimonial-item mb-3" src="~/Content/image/Testimonial/testimonial-1_200x200.jpg" alt="">
                        <p class="text-white mb-5 fs-4">
                            Nulla facilisi nullam vehicula ipsum.
                            Morbi tincidunt ornare massa eget egestas purus viverra accumsan in.
                            Vulputate enim nulla aliquet.
                        </p>
                        <h1 class="text-success fw-bold mb-2">Sakira Kent K.John</h1>
                        <h3 class="text-white">General Manager</h3>
                    </div>
                </div>
                <div class="col-12 col-sm-12 col-md-4 col-lg-4">
                    <div class="text-center testimonial">
                        <img class="rounded-circle w-25 testimonial-item mb-3" src="~/Content/image/Testimonial/testimonial-2_200x200.jpg" alt="">
                        <p class="text-white mb-5 fs-4">
                            Nulla facilisi nullam vehicula ipsum.
                            Morbi tincidunt ornare massa eget egestas purus viverra accumsan in.
                            Vulputate enim nulla aliquet.
                        </p>
                        <h1 class="text-success fw-bold mb-2">Hemanta M.Gomes</h1>
                        <h3 class="text-white">Programmer</h3>
                    </div>
                </div>
                <div class="col-12 col-sm-12 col-md-4 col-lg-4">
                    <div class="text-center testimonial">
                        <img class="rounded-circle w-25 testimonial-item mb-3" src="~/Content/image/Testimonial/testimonial-3_200x200.jpg" alt="">
                        <p class="text-white mb-5 fs-4">
                            Nulla facilisi nullam vehicula ipsum.
                            Morbi tincidunt ornare massa eget egestas purus viverra accumsan in.
                            Vulputate enim nulla aliquet.
                        </p>
                        <h1 class="text-success fw-bold mb-2">Alexnder N.Flowers</h1>
                        <h3 class="text-white">Professor</h3>
                    </div>
                </div>
            </div>
        </div>
    </section>


}

